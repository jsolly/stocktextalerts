---
import CTA from "../components/landing/CTA.astro";
import Features from "../components/landing/Features.astro";
import Hero from "../components/landing/Hero.astro";
import Navigation from "../components/layout/Navigation.astro";
import Layout from "../layouts/Layout.astro";
import { createSupabaseServerClient } from "../lib/supabase";
import { createUserService } from "../lib/users";

const supabase = createSupabaseServerClient();
const users = createUserService(supabase, Astro.cookies);
const user = await users.getCurrentUser();
const isAuthenticated = !!user;
const search = Astro.url.searchParams;

// Handle password reset redirects
const token = search.get("token");
const type = search.get("type");
if (token && type === "recovery") {
	// Redirect to recover page with the token
	return Astro.redirect(
		`/auth/recover?token=${encodeURIComponent(token)}&type=${encodeURIComponent(type)}`,
	);
}
---

<Layout title="Stock Text Alerts" description="Get price alerts, breaking news, and trend shifts for your stocksâ€”delivered straight to your phone via SMS.">
  <div class="min-h-screen bg-white">
    <Navigation user={user || undefined} />
    
    <Hero isAuthenticated={isAuthenticated} />

    <Features />
    <CTA isAuthenticated={isAuthenticated} />
  </div>
</Layout>

<script>
</script>
