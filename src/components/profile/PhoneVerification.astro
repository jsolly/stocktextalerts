---
import PhoneInput from "./PhoneInput.vue";

interface Props {
	user: {
		alert_via_sms: boolean;
		sms_opted_out: boolean;
		phone_verified: boolean;
		phone_country_code: string | null;
		phone_number: string | null;
	};
}

const { user } = Astro.props;
---

{user.alert_via_sms && (
	<div class="mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
		<h2 class="text-2xl font-bold text-gray-900 mb-4">Phone Verification</h2>
		
		{user.sms_opted_out && (
			<div class="mb-4 bg-red-50 border border-red-200 rounded-lg p-4">
				<p class="text-red-800">You have opted out of SMS alerts. Reply START to your last message to re-enable.</p>
			</div>
		)}

		{user.phone_verified ? (
			<div class="bg-green-50 border border-green-200 rounded-lg p-4">
				<p class="text-green-800">âœ“ Phone verified: {user.phone_country_code} {user.phone_number}</p>
			</div>
		) : (
			<div>
				<form method="POST" action="/api/alerts/sms/send-verification" class="space-y-4">
					<PhoneInput client:only="vue" />
					<button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
						Send Verification Code
					</button>
				</form>

				{user.phone_number && !user.phone_verified && (
					<form method="POST" action="/api/alerts/sms/verify-code" class="mt-6 space-y-4">
						<div>
							<label for="code" class="block text-sm font-medium text-slate-700 mb-1">
								Enter Verification Code
							</label>
						<input type="text" id="code" name="code" required
							maxlength="6" pattern="[0-9]{6}" inputmode="numeric"
							class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
							placeholder="123456" />
						</div>
						<button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
							Verify Code
						</button>
					</form>
				)}
			</div>
		)}
	</div>
)}

