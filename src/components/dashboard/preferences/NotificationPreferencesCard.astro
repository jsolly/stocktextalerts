---
import type { TimezoneOption } from "../../../lib/timezones/timezones";
import type { User } from "../../../lib/users";
import NotificationChannelsSection from "./NotificationChannelsSection.astro";

interface Props {
	user: User;
	timezones: TimezoneOption[];
	isEditingPhone: boolean;
}

const { user, timezones, isEditingPhone } = Astro.props;
---

<div class="mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
	<h2 class="text-2xl font-bold text-gray-900 mb-4">
		Notification Preferences
	</h2>

	<div class="space-y-6">
		<div>
			<label
				for="timezone"
				class="block text-sm font-medium text-slate-700 mb-1"
			>
				Timezone <span class="text-red-500">*</span>
			</label>
			<select
				id="timezone"
				name="timezone"
				required
				class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
			>
				<option value="">Select your timezone</option>
				{timezones.map((tz) => (
					<option value={tz.value} selected={user.timezone === tz.value}>
						{tz.label}
					</option>
				))}
			</select>
		</div>

		<NotificationChannelsSection user={user} isEditingPhone={isEditingPhone} />
	</div>
</div>

<script>
	import { setupDetectedTimezoneOption } from "../../../lib/timezones/timezone-select";
	import { DEFAULT_TIMEZONE } from "../../../lib/timezones/timezone-constants";

	if (document.readyState === "loading") {
		document.addEventListener("DOMContentLoaded", () => {
			setupDetectedTimezoneOption({ defaultTimezone: DEFAULT_TIMEZONE });
		});
	} else {
		setupDetectedTimezoneOption({ defaultTimezone: DEFAULT_TIMEZONE });
	}
</script>

