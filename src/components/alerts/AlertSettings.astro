---
interface Props {
	user: {
		alert_via_email: boolean;
		alert_via_sms: boolean;
		timezone: string | null;
		alert_start_hour: number;
		alert_end_hour: number;
	};
}

const { user } = Astro.props;

const US_TIMEZONES = [
	{ value: "America/New_York", label: "Eastern Time (ET)" },
	{ value: "America/Chicago", label: "Central Time (CT)" },
	{ value: "America/Denver", label: "Mountain Time (MT)" },
	{ value: "America/Phoenix", label: "Mountain Time - Arizona (MT)" },
	{ value: "America/Los_Angeles", label: "Pacific Time (PT)" },
	{ value: "America/Anchorage", label: "Alaska Time (AKT)" },
	{ value: "Pacific/Honolulu", label: "Hawaii Time (HT)" },
];

const hours = Array.from({ length: 24 }, (_, i) => i);
---

<div class="mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
	<h2 class="text-2xl font-bold text-gray-900 mb-4">Alert Settings</h2>
	
	<form method="POST" action="/api/alerts/update" class="space-y-6">
		<div>
			<label class="block text-sm font-medium text-slate-700 mb-2">
				Alert Delivery Methods (select at least one)
			</label>
			<div class="space-y-2">
				<label class="flex items-center">
					<input type="checkbox" name="alert_via_email" class="mr-2" checked={user.alert_via_email} />
					<span>Email Alerts</span>
				</label>
				<label class="flex items-center">
					<input type="checkbox" name="alert_via_sms" class="mr-2" checked={user.alert_via_sms} />
					<span>SMS Alerts</span>
				</label>
			</div>
		</div>

		<div>
			<label for="timezone" class="block text-sm font-medium text-slate-700 mb-1">
				Timezone <span class="text-red-500">*</span>
			</label>
			<select id="timezone" name="timezone" required
				class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
				<option value="">Select your timezone</option>
				{US_TIMEZONES.map(tz => (
					<option value={tz.value} selected={user.timezone === tz.value}>
						{tz.label}
					</option>
				))}
			</select>
		</div>

		<div class="grid grid-cols-2 gap-4">
			<div>
				<label for="alert_start_hour" class="block text-sm font-medium text-slate-700 mb-1">
					Start Hour (24h format)
				</label>
				<select id="alert_start_hour" name="alert_start_hour"
					class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
					{hours.map(hour => (
						<option value={hour} selected={user.alert_start_hour === hour}>
							{String(hour).padStart(2, '0')}:00
						</option>
					))}
				</select>
			</div>
			<div>
				<label for="alert_end_hour" class="block text-sm font-medium text-slate-700 mb-1">
					End Hour (24h format)
				</label>
				<select id="alert_end_hour" name="alert_end_hour"
					class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
					{hours.map(hour => (
						<option value={hour} selected={user.alert_end_hour === hour}>
							{String(hour).padStart(2, '0')}:00
						</option>
					))}
				</select>
			</div>
		</div>

		<button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
			Save Settings
		</button>
	</form>
</div>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		if (!Intl || !Intl.DateTimeFormat) {
			return;
		}

		const timezoneSelect = document.getElementById('timezone') as HTMLSelectElement;
		if (timezoneSelect && !timezoneSelect.value) {
			const detectedTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
			const option = timezoneSelect.querySelector(`option[value="${detectedTimezone}"]`);
			if (option) {
				timezoneSelect.value = detectedTimezone;
			}
		}
	});
</script>
